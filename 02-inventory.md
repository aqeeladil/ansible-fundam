# Ansible Inventory

Ansible inventory file is a fundamental component of Ansible that defines the hosts (remote systems) that you want to manage and the groups those hosts belong to. 

The inventory file can be static (a simple text file) or dynamic (generated by a script). It provides Ansible with the information about the remote nodes to communicate with during its operations.

## 1. Static Inventory

**INI Format (Traditional):** A simple text file listing servers by name, IP address, or groupings.

```ini
# inventory file: hosts

[webservers]
web1.example.com
web2.example.com

[dbservers]
db1.example.com
db2.example.com

[all:vars]
ansible_user=admin
ansible_ssh_private_key_file=/path/to/key
```

**YAML Format:** Newer and more structured, though less commonly used in basic setups.

```yaml
# inventory file: hosts.yaml

all:
  vars:
    ansible_user: admin
    ansible_ssh_private_key_file: /path/to/key
  children:
    webservers:
      hosts:
        web1.example.com:
        web2.example.com:
    dbservers:
      hosts:
        db1.example.com:
        db2.example.com:
```

## 2. Dynamic Inventory

Ansible's dynamic inventory is a feature that allows Ansible to fetch information about hosts and groups from external sources in real time, instead of using a static inventory file. It allows for flexible, up-to-date host management, and is particularly useful in dynamic or cloud environments where servers may frequently scale up or down.

For AWS, you can use the aws_ec2 plugin to automatically fetch instances, grouping them by tags, regions, or other criteria. This enables Ansible to always have an updated list of hosts, perfect for scaling environments.

Here is an example of a dynamic inventory script for AWS EC2:

```
#!/usr/bin/env python

import json
import boto3

def get_aws_ec2_inventory():
    ec2 = boto3.client('ec2')
    instances = ec2.describe_instances()
    inventory = {
        'all': {
            'hosts': [],
            'vars': {
                'ansible_user': 'ec2-user',
                'ansible_ssh_private_key_file': '/path/to/key'
            }
        },
        '_meta': {
            'hostvars': {}
        }
    }

    for reservation in instances['Reservations']:
        for instance in reservation['Instances']:
            if instance['State']['Name'] == 'running':
                public_ip = instance['PublicIpAddress']
                inventory['all']['hosts'].append(public_ip)
                inventory['_meta']['hostvars'][public_ip] = {
                    'ansible_host': public_ip
                }

    print(json.dumps(inventory, indent=2))

if __name__ == '__main__':
    get_aws_ec2_inventory()
```

**Usage:**

`ansible-playbook -i inventory <Adhoc command or Playbook.yml>`

## 3. Default Location:

- If no custom inventory file is provided, Ansible looks for a file named `hosts` in `/etc/ansible/`.

- If you create a custom inventory file, provide its path using the `-i` flag in commands.

## 4. Grouping Servers:

Servers can be grouped (e.g., `app` and `db`) to execute tasks on specific sets of machines.

```ini
[app]
app1 ansible_host=192.168.1.10
app2 ansible_host=192.168.1.11

[db]
db1 ansible_host=192.168.1.20
db2 ansible_host=192.168.1.21
```

Use `ansible -i inventory.ini -m ping app` to ping all servers in the `app` group.


